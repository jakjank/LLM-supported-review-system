name: Read PR Body
run-name: reading PR

on:
  pull_request:
    types: [opened, edited]
  workflow_dispatch:

jobs:
  review-system:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
     - name: checkout
       uses: actions/checkout@v4
  # [ przygotowanie llamy ]
     - name: install ollama
       run: curl -fsSL https://ollama.com/install.sh | sh 
     - name: download llama2
       run: ollama pull llama2
     - name: start llama2
       run: ollama serve
       continue-on-error: true
 # [ przygotowanie pdm - tego pewnie kiedy nie bedzie - chcemy miec w przyszlosci Dockera i skompilowana paczke pythonowa ]
     - name: install pdm
       run: curl -sSL https://pdm-project.org/install-pdm.py | python3 -
     - name: prepare pdm
       working-directory: project
       run: pdm install
 # [ przygotowanie srodowiska do pracy ]
     - name: prepare folder for file
       run: mkdir SRS_files
     - name: fetch
       run: git fetch --no-tags --prune --depth=1 origin +refs/heads/*:refs/remotes/origin/*
     - name: diff
       working-directory: SRS_files
       run: git diff --output=diff.txt origin/main HEAD
 # [ zadawanie promptow llamie ]
     - name: ask prompts
       run: pdm --project project run start
 # [ dodanie komentarza ]
     - name: comment PR
       uses: thollander/actions-comment-pull-request@v2.5.0
       with:
         filePath: SRS_files/comment.txt
         pr_number: ${{github.event.number}}
       env:
         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
 # [ posprzatanie srodowiska po pracy ]
     - name: clean up
       run: rm -r SRS_files
